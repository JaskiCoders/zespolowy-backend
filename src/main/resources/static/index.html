<!DOCTYPE HTML>
<!-- plik przygotowala Izabela Wasyluk -->
<html>
<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
<div class="slidecontainer">
    <input  id="threshold" type="range" min="0" max="1000" value="500" class="slider">
</div>
<div class="container">
    <div id="alert"></div>

    <div class="buttonscontainer">
        <button id="runWS" class="myButton"> Run websocket </button>
        <button id="runRest" class="myButton"> Run rest </button>
    </div>

    <div class="row">
        <div class="col-xs-2 image-container "></div>
        <div class="col-xs-2 image-container" id="webCam2"><img class="image" id="img1"/></div>
        <div class="col-xs-2 image-container "></div>
    </div>
    <div class="row">
        <div class="col-xs-2 image-container " id="webCam1"><img class="image" id="img2"/></div>
        <div class="col-xs-2 image-container" ></div>
        <div class="col-xs-2 image-container " id="webCam3"><img class="image" id="img3"/></div>
    </div>
    <div class="row">
        <div class="col-xs-2 image-container"></div>
        <div class="col-xs-2 image-container " id="webCam4"><img class="image" id="img4"/></div>
        <div class="col-xs-2 image-container"></div>
    </div>
</div>
<script type="text/javascript">

    function WebSocketTest() {
        var timestampSum = 0;
        var timestampCounter = 0;
            if ("WebSocket" in window) {
                document.getElementById("alert").innerText = "WebSocket is supported by your Browser!";
                // Otworz polaczenie WebSocket
                var ws = new WebSocket("ws://localhost:8088/frame");

                ws.onopen = function () {

                    // wyslij dane przez polaczenie
                    ws.send("Message to send");

                    document.getElementById("alert").innerText = "Message is sent...";
                };

                ws.onmessage = function (evt) {
                    var jsonData = JSON.parse(evt.data);
                    average(jsonData.timestamp)
                    document.getElementById("img1").src = "data:image/jpg;base64," + jsonData.value;
                };

                ws.onclose = function () {
                    // wyswiel komunikat ze polaczenie jest zamkniete
                    document.getElementById("alert").innerText = "Connection is closed...";
                };
                function average(timestamp) {
                    var date = new Date();
                    var currentTime = date.getTime();
                    timestampSum += currentTime - timestamp;
                    if(timestampCounter == 100){
                        console.log(timestampSum/100)
                        timestampSum = 0;
                        timestampCounter = 0;
                    }
                    timestampCounter++;
                }
            } else {
                alert("WebSocket NOT supported by your Browser!");
            }
        }

    function restTest() {
            var timestampSum = 0;
            var timestampCounter = 0;
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open("GET", "http://localhost:8088/getFrameByRest", false); // false for synchronous request
            xmlHttp.send(null);
            var jsonData = JSON.parse(xmlHttp.responseText);
            average(jsonData.timestamp)
            document.getElementById("img1").src = "data:image/jpg;base64," + jsonData.value;

            function average(timestamp) {
                var date = new Date();
                var currentTime = date.getTime();
                timestampSum += currentTime - timestamp;
                if (timestampCounter == 100) {
                    console.log(timestampSum / 100)
                    timestampSum = 0;
                    timestampCounter = 0;
                }
                timestampCounter++;
            }
    }

    var runButton = document.getElementById("runWS");
    runButton.onclick = function () {
        WebSocketTest();
    }
    var runRestButton = document.getElementById("runRest");
    runRestButton.onclick = function () {
        restTest();
    }
</script>
</body>
</html>